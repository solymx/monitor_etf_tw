name: 982a Daily ETF Crawler

on:
  schedule:
    # GitHub Actions ä½¿ç”¨ UTC æ™‚é–“
    # å°ç£æ™‚é–“ 18:15 (æ™šä¸Š 6:15) - 8å°æ™‚ = UTC 10:15
    - cron: '15 10 * * *'
  workflow_dispatch: # å…è¨±æ‰‹å‹•é»æ“ŠæŒ‰éˆ•è§¸ç™¼ (æ–¹ä¾¿æ¸¬è©¦ç”¨)

jobs:
  build:
    runs-on: ubuntu-latest
    
    # çµ¦äºˆæ©Ÿå™¨äººå¯«å…¥æ¬Šé™ï¼Œé€™æ¨£æ‰èƒ½å°‡ CSV/HTML å­˜å›å€‰åº«
    permissions:
      contents: write

    steps:
      - name: Checkout code (ä¸‹è¼‰ç¨‹å¼ç¢¼)
        uses: actions/checkout@v4

      - name: Set up Python (è¨­å®š Python ç’°å¢ƒ)
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies (å®‰è£å¥—ä»¶)
        run: |
          python -m pip install --upgrade pip
          # å®‰è£ä½ çš„ç¨‹å¼éœ€è¦çš„ pandas, requests ä»¥åŠ pandas è¼¸å‡º HTML éœ€è¦çš„ jinja2
          pip install requests pandas jinja2

      - name: Run crawler script (åŸ·è¡Œçˆ¬èŸ²)
        env:
          TZ: 'Asia/Taipei' # è¨­å®šæ™‚å€ï¼Œç¢ºä¿ Python æŠ“åˆ°çš„ datetime æ˜¯å°ç£æ™‚é–“
        run: |
          # Python æª”å
          python 982a.py

      - name: Commit and push changes (å­˜æª”ä¸¦ä¸Šå‚³)
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # åŠ å…¥æ‰€æœ‰è®Šæ›´ (åŒ…å«æ–°ç”¢ç”Ÿçš„ CSV, HTML å’Œç§»å‹•åˆ°å‚™ä»½è³‡æ–™å¤¾çš„æª”æ¡ˆ)
          git add .
          
          # æäº¤è®Šæ›´ï¼Œå¦‚æœæ²’æœ‰è®Šæ›´ (ä¾‹å¦‚ç•¶å¤©ä¼‘å¸‚) å‰‡ä¸å ±éŒ¯
          git commit -m "ğŸ“Š Auto-update ETF data: $(date +'%Y-%m-%d')" || exit 0
          
          # æ¨é€å›å€‰åº«
          git push
